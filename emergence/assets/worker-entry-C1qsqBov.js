(function(){"use strict";const O=["Petro","Atlas","Titan","Continental","Pacific","Gulf","Summit","Eagle","Iron","Coal","Deep","Black","Grand","Royal","Imperial","Global","National","Crown","Frontier","Pioneer","Western","Eastern","Northern","Southern","Central","United","Federal","Patriot","Heritage","Legacy","Bedrock","Anchor","Titan","Apex","Prime","Sovereign","Dominion","Empire","Citadel","Bastion","Fortress","Rampart"],$=["Energy","Oil","Gas","Petroleum","Resources","Mining","Fuels","Power","Corp","Holdings","Industries","Extraction","Drilling","Exploration","Supply","Carbon","Hydro","Thermal"],U=["Sun","Solar","Wind","Green","Bright","Clear","Nova","Eco","Tera","Volt","Flux","Helio","Aero","Hydra","Bio","Geo","Clean","Pure","Zero","Net","Blue","Sky","Aurora","Photon","Quantum","Nexus","Horizon","Zenith","Apex","Pinnacle","Spark","Radiant","Lumina","Solaris","Verdant","Evergreen","Pristine"],X=["Power","Energy","Solar","Wind","Tech","Systems","Dynamics","Solutions","Innovations","Labs","Ventures","Works","Grid","Renewables","Electric","Charge","Watts","Cell"],F=["Trans","Omni","Multi","Flex","Adapt","Bridge","Shift","Evolve","Hybrid","Dual","Core","Meta","Proto","Sync","Pivot","Transform","Cross","Inter","Pan","Universal"],N=["Energy","Power","Group","Partners","Capital","Holdings","Enterprises","Corp","International","Alliance","Network"],D=["BlackStone Capital","Sequoia Green Fund","Vanguard ESG","Bridgewater Climate","Renaissance Energy","Citadel Transition","Two Sigma Clean","DE Shaw Climate","Point72 Green","Millennium ESG","Baupost Sustainable","Third Point Energy","Elliott Climate","Pershing Square Green","Ares Clean Capital","KKR Transition","Apollo Green","Carlyle Climate","TPG Rise","Brookfield Renewable","GIC Sustainable","ADIA Green","Norges Climate","CalPERS ESG","Ontario Teachers Green","CDPQ Climate","Temasek Sustainable","Mubadala Clean","Khazanah Green","Future Fund ESG"];let k=new Set;function B(e){return e[Math.floor(Math.random()*e.length)]}function E(e,t){for(let n=0;n<50;n++){const r=`${B(e)} ${B(t)}`;if(!k.has(r))return k.add(r),r}const i=`${B(e)} ${B(t)} ${Math.floor(Math.random()*99)}`;return k.add(i),i}function Y(e){switch(e){case"fossil":return E(O,$);case"renewable":return E(U,X);case"mixed":return E(F,N);default:return E(F,N)}}function V(e){return D[e%D.length]}function K(){k=new Set}const R={fossil:80,renewable:40,mixed:80,investors:30},j=[{id:"NA",name:"North America",carbonTax:5,subsidy:.05,strictness:.3},{id:"EU",name:"Europe",carbonTax:25,subsidy:.12,strictness:.5},{id:"CN",name:"China",carbonTax:8,subsidy:.08,strictness:.4},{id:"IN",name:"India",carbonTax:2,subsidy:.03,strictness:.2},{id:"AF",name:"Africa",carbonTax:0,subsidy:.01,strictness:.1},{id:"LA",name:"Latin America",carbonTax:3,subsidy:.04,strictness:.2}],b={solarBaseCost:120,windBaseCost:80,batteryBaseCost:150,baseCapacity:1e3},I={baseDemand:14e3,demandGrowth:.02,fossilBaseCost:60,emissionFactor:.5},M={tcre:1.65,baseTemp:1.3,baseCumEmissions:2500},L={coefficient:.01145,worldGDP:110},S={renewable_crossover:{title:"Renewable Crossover",text:"Renewables now provide more energy than fossil fuels. Traditional economic models consistently predicted this would take decades longer. The agents in this simulation followed Wright's Law — as deployment scaled, costs dropped exponentially, creating a self-reinforcing adoption loop."},bankruptcy_cascade:{title:"Bankruptcy Cascade",text:"Multiple fossil companies collapsed simultaneously. In Doyne Farmer's complexity models, crashes like this emerge internally from agent interactions — not from external shocks. Companies chasing each other's strategies created a fragile herd that collapsed together."},investment_stampede:{title:"Investment Stampede",text:'Capital is flooding into renewables. This is the "tipping point" that complexity economics predicts — once the expected return on green investment exceeds fossil, rational actors pile in, creating a self-fulfilling prophecy that accelerates the transition.'},temp_15:{title:"1.5°C Breached",text:"Global warming has passed 1.5°C above pre-industrial levels — the Paris Agreement's aspirational target. Beyond this threshold, climate damages begin to compound non-linearly, creating feedback loops that stress the economic system."},temp_20:{title:"2.0°C Breached",text:"The 2°C guardrail has been crossed. The Exeter/Carbon Tracker report estimates that when cascading risks are included, 2°C warming by 2050 could mean a 25% hit to projected GDP — far worse than traditional models predict."},temp_30:{title:"3.0°C Warning",text:`At 3°C+ warming, physical climate scientists say "the economy and society will cease to function as we know it" — yet some economic models still project only a 10% GDP loss. This disconnect is what Farmer's complexity approach aims to fix.`}};let _=42;function q(e){_=e}function T(){return _=(_*16807+0)%2147483647,(_&2147483647)/2147483647}function d(e,t){return e+T()*(t-e)}function G(e,t){const i=t==="fossil",n=t==="renewable",r=i?d(200,2e3):n?0:d(100,1e3),l=n?d(50,500):i?0:d(20,200);return{id:e,name:Y(t),type:t,capital:d(5,80),assets:{fossil:{capacity:r,age:i?d(10,40):d(5,20),revenue:0},renewable:{capacity:l,age:n?d(2,10):d(1,5),revenue:0}},strategy:{greenInvestRate:i?d(0,.15):n?d(.85,1):d(.2,.6),riskTolerance:d(.2,.8),imitationRate:d(.05,.3),innovationRate:d(.02,.15)},debt:d(0,20),revenue:0,profit:0,capitalHistory:[],decisionLog:[],alive:!0,yearsNegative:0}}function z(){const e=[];let t=0;for(let i=0;i<R.fossil;i++)e.push(G(t++,"fossil"));for(let i=0;i<R.renewable;i++)e.push(G(t++,"renewable"));for(let i=0;i<R.mixed;i++)e.push(G(t++,"mixed"));return e}function Q(){return j.map((e,t)=>({id:1e3+t,region:e.id,name:e.name,carbonTax:e.carbonTax,renewableSubsidy:e.subsidy,regulationStrictness:e.strictness,publicOpinion:.3,agentType:"government"}))}function Z(){const e=[];for(let t=0;t<R.investors;t++)e.push({id:2e3+t,name:V(t),capital:d(20,200),portfolio:[],riskAppetite:d(.3,.9),esgWeight:d(.05,.4),agentType:"investor"});return e}function J(e,t,i,n){if(!e.alive)return;const{fossilPrice:r,renewablePrice:l,carbonPrice:c,renewableSubsidy:a}=t,s=e.assets,u=s.fossil.capacity*r/1e3,f=s.renewable.capacity*(l+a)/1e3;s.fossil.revenue=u,s.renewable.revenue=f,e.revenue=u+f;const m=s.fossil.capacity*.04+s.renewable.capacity*.015,y=e.debt*.05,g=s.fossil.capacity*c/1e3,o=m+y+g;e.profit=e.revenue-o,e.capital+=e.profit,e.capitalHistory.push(e.capital),e.capitalHistory.length>20&&e.capitalHistory.shift();const p=Math.max(0,e.profit*.4+e.capital*.02),C=(r-c*.5-40)/100,x=(l+a-15)/80,P=1+(T()-.5)*.3;let h=e.strategy.greenInvestRate;x>C?h=Math.min(1,h+.05*P):h=Math.max(0,h-.03*P);const A=p*h,oe=p*(1-h);if(s.renewable.capacity+=A*8,s.fossil.capacity=Math.max(0,s.fossil.capacity+oe*5-s.fossil.capacity*.02),s.fossil.age+=1,s.renewable.age+=1,T()<e.strategy.imitationRate&&n.length>0){const w=n[Math.floor(T()*n.length)],le=e.strategy.greenInvestRate;e.strategy.greenInvestRate=e.strategy.greenInvestRate*.7+w.strategy.greenInvestRate*.3,Math.abs(e.strategy.greenInvestRate-le)>.05&&e.decisionLog.push(`Yr${t.year}: Imitated ${w.name}'s green strategy`)}if(T()<e.strategy.innovationRate){const w=(T()-.5)*.1;e.strategy.greenInvestRate=Math.max(0,Math.min(1,e.strategy.greenInvestRate+w)),Math.abs(w)>.03&&e.decisionLog.push(`Yr${t.year}: Innovated strategy ${w>0?"greener":"browner"}`)}e.decisionLog.length>8&&e.decisionLog.shift(),e.capital<0?(e.yearsNegative++,e.yearsNegative>=3&&(e.alive=!1,e.decisionLog.push(`Yr${t.year}: BANKRUPT`))):e.yearsNegative=0;const W=s.fossil.capacity+s.renewable.capacity;if(W>0){const w=s.renewable.capacity/W;w>.8?e.type="renewable":w<.2?e.type="fossil":e.type="mixed"}}function ee(e,t,i){const n=t.filter(a=>a.alive);if(n.length===0)return;e.esgWeight=Math.min(.9,e.esgWeight+(i-1.3)*.005);const r=n.map(a=>{const s=a.assets.fossil.capacity+a.assets.renewable.capacity,u=s>0?a.assets.renewable.capacity/s:0,f=Math.max(0,a.profit)/10,m=u;return{company:a,score:f*(1-e.esgWeight)+m*e.esgWeight}}).sort((a,s)=>s.score-a.score),l=Math.ceil(n.length*.3),c=e.capital*.03;for(let a=0;a<l&&a<r.length;a++){const s=c/l;r[a].company.capital+=s,e.capital-=s}e.portfolio=r.slice(0,l).map(a=>({companyId:a.company.id,score:a.score}))}function te(e,t,i,n=0,r=!1,l=null){const c=Math.max(0,(t-1)*.3),a=Math.max(0,i*.1);if(e.publicOpinion=Math.max(0,Math.min(1,e.publicOpinion*.9+(c-a+n)*.1)),r){e.carbonTax*=.5,e.renewableSubsidy*=.5;return}if(l){e.carbonTax=l.carbonTax??e.carbonTax,e.renewableSubsidy=l.subsidy??e.renewableSubsidy;return}e.publicOpinion>.5?(e.carbonTax=Math.min(200,e.carbonTax+e.publicOpinion*3),e.renewableSubsidy=Math.min(.5,e.renewableSubsidy+e.publicOpinion*.01)):(e.carbonTax=Math.max(0,e.carbonTax-1),e.renewableSubsidy=Math.max(0,e.renewableSubsidy-.005))}function se(){return{fossilPrice:70,renewablePrice:b.solarBaseCost,carbonPrice:10,renewableSubsidy:.05,demand:I.baseDemand,supply:{fossil:0,renewable:0},cumulativeRenewableCapacity:b.baseCapacity,technologyCost:{solar:b.solarBaseCost,wind:b.windBaseCost,battery:b.batteryBaseCost},fossilPriceMultiplier:1,renewableCostMultiplier:1,demandMultiplier:1,year:2025}}function ie(e,t,i,n,r=1){const l=t.filter(p=>p.alive);let c=0,a=0;for(const p of l)c+=p.assets.fossil.capacity,a+=p.assets.renewable.capacity;e.supply.fossil=c,e.supply.renewable=a,e.cumulativeRenewableCapacity+=a*.001;const s=Math.pow(e.cumulativeRenewableCapacity/b.baseCapacity,-.32*r);e.technologyCost.solar=b.solarBaseCost*s*e.renewableCostMultiplier,e.technologyCost.wind=b.windBaseCost*s*e.renewableCostMultiplier,e.technologyCost.battery=b.batteryBaseCost*s*e.renewableCostMultiplier;const u=1+I.demandGrowth*(1-n*.5);e.demand*=u*e.demandMultiplier,e.demandMultiplier=1+(e.demandMultiplier-1)*.7,e.fossilPriceMultiplier=1+(e.fossilPriceMultiplier-1)*.7,e.renewableCostMultiplier=1+(e.renewableCostMultiplier-1)*.8;const f=i.reduce((p,C)=>p+C.carbonTax,0)/i.length,m=i.reduce((p,C)=>p+C.renewableSubsidy,0)/i.length;e.carbonPrice=f,e.renewableSubsidy=m;const y=c+a,g=y>0?e.demand/(y*.8):1,o=Math.max(.5,Math.min(2,g));e.fossilPrice=(I.fossilBaseCost+f*.5)*o*e.fossilPriceMultiplier,e.renewablePrice=Math.max(15,e.technologyCost.solar*.8)*o}function ae(){return{emissions:0,cumulativeEmissions:M.baseCumEmissions,temperature:M.baseTemp,tempBoost:0,damages:0,damagesTrillions:0,gdpGrowth:.03}}function ne(e,t){const i=t.filter(r=>r.alive);let n=0;for(const r of i)n+=r.assets.fossil.capacity;e.emissions=n*I.emissionFactor/1e3,e.cumulativeEmissions+=e.emissions,e.temperature=M.baseTemp+(e.cumulativeEmissions-M.baseCumEmissions)*M.tcre/1e3+e.tempBoost,e.tempBoost*=.9,e.damages=Math.min(.8,L.coefficient*e.temperature*e.temperature),e.damagesTrillions=e.damages*L.worldGDP,e.gdpGrowth=Math.max(-.05,.03-e.damages*.1)}class H{constructor(t=42){q(t),K(),this.year=2025,this.tick=0,this.companies=z(),this.governments=Q(),this.investors=Z(),this.market=se(),this.climate=ae(),this.events=[],this.history=[],this.userPolicy=null,this.opinionBoost=0,this.policyReversalActive=!1,this.rdBoost=1,this._prevRenewShare=0,this._prevFossilValue=0,this._bankruptThisTick=0,this._renewInvestShare=0}step(){this.year++,this.tick++,this.market.year=this.year,this.events=[],this._bankruptThisTick=0,ie(this.market,this.companies,this.governments,this.climate.damages,this.rdBoost);const t=this.companies.filter(s=>s.alive),i=[...t].sort((s,u)=>u.profit-s.profit),n=i.slice(0,Math.ceil(i.length*.1)),r={carbonTax:this.governments.reduce((s,u)=>s+u.carbonTax,0)/this.governments.length,subsidy:this.governments.reduce((s,u)=>s+u.renewableSubsidy,0)/this.governments.length},l=t.length;for(const s of this.companies)J(s,{fossilPrice:this.market.fossilPrice,renewablePrice:this.market.renewablePrice,carbonPrice:this.market.carbonPrice,renewableSubsidy:this.market.renewableSubsidy,year:this.year},r,n);this._bankruptThisTick=l-this.companies.filter(s=>s.alive).length;for(const s of this.investors)ee(s,this.companies,this.climate.temperature);for(const s of this.governments)te(s,this.climate.temperature,this.climate.gdpGrowth,this.opinionBoost,this.policyReversalActive,this.userPolicy);this.opinionBoost*=.5,this.policyReversalActive=!1,ne(this.climate,this.companies);const c=this.computeAggregates();this.detectEvents(c);const a={year:this.year,tick:this.tick,aggregates:c,market:{...this.market,technologyCost:{...this.market.technologyCost}},climate:{...this.climate}};return this.history.push(a),this.getState()}computeAggregates(){const t=this.companies.filter(h=>h.alive),i=this.companies.filter(h=>!h.alive);let n=0,r=0,l=0,c=0,a=0,s=0,u=0,f=0,m=0,y=0;for(const h of t)n+=h.assets.fossil.capacity,r+=h.assets.renewable.capacity,m+=h.profit,y+=h.capital,h.type==="fossil"?l++:h.type==="renewable"?c++:a++;for(const h of i)h.type==="fossil"?s++:h.type==="renewable"?u++:f++;const g=n+r,o=g>0?r/g:0,p=g>0?n/g:0;let C=0,x=0;for(const h of t){const A=Math.max(0,h.profit*.4+h.capital*.02);C+=A*h.strategy.greenInvestRate,x+=A}const P=x>0?C/x:0;return{energyMix:{fossil:p,renewable:o},population:{fossilAlive:l,fossilDead:s,renewAlive:c,renewDead:u,mixedAlive:a,mixedDead:f,totalAlive:t.length,totalDead:i.length},avgProfit:t.length>0?m/t.length:0,avgCapital:t.length>0?y/t.length:0,totalBankruptcies:i.length,bankruptciesThisTick:this._bankruptThisTick,investmentFlows:{renewable:P,fossil:1-P},technologyCost:{...this.market.technologyCost}}}detectEvents(t){t.energyMix.renewable>.5&&this._prevRenewShare<=.5&&this.events.push({type:"renewable_crossover",year:this.year,...S.renewable_crossover}),this._prevRenewShare=t.energyMix.renewable,t.bankruptciesThisTick>=3&&this.events.push({type:"bankruptcy_cascade",year:this.year,...S.bankruptcy_cascade}),t.investmentFlows.renewable>.6&&this._renewInvestShare<=.6&&this.events.push({type:"investment_stampede",year:this.year,...S.investment_stampede}),this._renewInvestShare=t.investmentFlows.renewable;const i=this.climate.temperature;i>=1.5&&this.climate.temperature-this.climate.emissions*.00165<1.5&&(this._firedTemp15||(this.events.push({type:"temp_15",year:this.year,...S.temp_15}),this._firedTemp15=!0)),i>=2&&!this._firedTemp20&&(this.events.push({type:"temp_20",year:this.year,...S.temp_20}),this._firedTemp20=!0),i>=3&&!this._firedTemp30&&(this.events.push({type:"temp_30",year:this.year,...S.temp_30}),this._firedTemp30=!0)}applyShock(t){switch(this.market,this.climate,this.opinionBoost,this.policyReversalActive,t){case"oil_crisis":this.market.fossilPriceMultiplier=1.8;break;case"tech_breakthrough":this.market.renewableCostMultiplier=.5;break;case"recession":this.market.demandMultiplier=.85;break;case"climate_disaster":this.climate.tempBoost+=.1,this.opinionBoost=.3;break;case"policy_reversal":this.policyReversalActive=!0;break}}setPolicy(t){this.userPolicy=t,t.rdBoost!==void 0&&(this.rdBoost=t.rdBoost)}getState(){return{year:this.year,tick:this.tick,companies:this.companies.map(t=>({...t,assets:{...t.assets,fossil:{...t.assets.fossil},renewable:{...t.assets.renewable}},strategy:{...t.strategy},capitalHistory:[...t.capitalHistory],decisionLog:[...t.decisionLog]})),governments:this.governments.map(t=>({...t})),investors:this.investors.map(t=>({...t,portfolio:[...t.portfolio]})),market:{fossilPrice:this.market.fossilPrice,renewablePrice:this.market.renewablePrice,carbonPrice:this.market.carbonPrice,renewableSubsidy:this.market.renewableSubsidy,demand:this.market.demand,supply:{...this.market.supply},technologyCost:{...this.market.technologyCost}},climate:{...this.climate},aggregates:this.computeAggregates(),events:[...this.events]}}}function re(e,t=null){const i=[];for(let n=0;n<e;n++){const r=new H(42+n*7);t&&r.setPolicy(t);let l=null,c=0;for(let a=0;a<75;a++){const s=r.step();s.aggregates.energyMix.renewable>.5&&l===null&&(l=s.year),c=Math.max(c,s.aggregates.bankruptciesThisTick)}i.push({finalTemp:r.climate.temperature,finalRenewShare:r.computeAggregates().energyMix.renewable,crossoverYear:l,totalBankruptcies:r.companies.filter(a=>!a.alive).length,hadCascade:c>=3})}return i}let v=null;self.onmessage=function(e){const{type:t,payload:i}=e.data;switch(t){case"init":{const n=i?.seed??Math.floor(Math.random()*1e5);v=new H(n),self.postMessage({type:"tick",payload:v.getState()});break}case"step":{if(!v)return;const n=v.step();if(self.postMessage({type:"tick",payload:n}),n.events.length>0)for(const r of n.events)self.postMessage({type:"event",payload:r});break}case"setPolicy":{if(!v)return;v.setPolicy(i);break}case"shock":{if(!v)return;v.applyShock(i.shockType);break}case"monteCarlo":{const n=i?.runs??500,r=i?.policy??null,l=re(n,r),c=l.filter(o=>o.crossoverYear).map(o=>o.crossoverYear),a=l.map(o=>o.finalTemp),s={};for(let o=2030;o<=2100;o+=5)s[o]=0;for(const o of c){const p=Math.floor(o/5)*5;s[p]!==void 0&&s[p]++}const u={};for(let o=1;o<=4;o+=.2)u[o.toFixed(1)]=0;for(const o of a){const p=(Math.round(o*5)/5).toFixed(1);u[p]!==void 0&&u[p]++}const f=a.filter(o=>o<1.5).length/a.length,m=a.filter(o=>o<2).length/a.length,y=l.filter(o=>o.hadCascade).length/l.length,g=l.filter(o=>!o.crossoverYear).length;self.postMessage({type:"mcResult",payload:{n,crossoverBins:s,tempBins:u,stats:{pBelow15:f,pBelow20:m,pCascade:y},medianCrossover:c.length>0?c.sort((o,p)=>o-p)[Math.floor(c.length/2)]:null,medianTemp:a.sort((o,p)=>o-p)[Math.floor(a.length/2)],noCrossoverCount:g}});break}}}})();
